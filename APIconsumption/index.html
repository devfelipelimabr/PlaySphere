<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Games</title>
  </head>
  <body>
    <div class="loginForm">
      <h4>Login admin</h4>
      <label for="email">Email: </label>
      <input type="email" name="email" id="email" />
      <br />
      <label for="password">Senha: </label>
      <input type="password" name="password" id="password" />
      <br />
      <button type="submit" onclick="login()">Logar</button>
    </div>
    <hr />
    <div class="gameList">
      <h2>Lista de jogos</h2>
      <ul id="gameList"></ul>
    </div>
    <hr />
    <div class="newGameForm">
      <h2>Criação de novo jogo</h2>
      <label for="imageUrl">URL da imagem: </label>
      <input type="text" name="imageUrl" id="imageUrl" />
      <br />
      <label for="title">Nome: </label>
      <input type="text" name="title" id="title" />
      <br />
      <label for="year">Ano: </label>
      <input type="number" name="year" id="year" />
      <br />
      <label for="price">Preço(R$): </label>
      <input type="number" name="price" id="price" />
      <br />
      <select name="categoryId" id="categoryId">
        <option value=""></option>
      </select>
      <br />
      <button type="submit" onclick="gameCreate()">Criar</button>
    </div>
    <hr />
  </body>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    function login() {
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const form = document.getElementsByClassName("loginForm")[0];

      const admin = {
        email: emailInput.value,
        password: passwordInput.value,
      };
      axios
        .post("http://localhost:5678/login", admin)
        .then((reply) => {
          if (reply.status == 200) {
            form.style.display = "none";
            alert("Login succes!");
          } else {
            alert(`Login fail ${admin.email} ${admin.password}`);
          }
        })
        .catch((err) => {
          console.log(err);
        });
    }

    function gameCreate() {
      const imageUrl = document.getElementById("imageUrl");
      const title = document.getElementById("title");
      const year = document.getElementById("year");
      const price = document.getElementById("price");
      const categoryId = document.getElementById("categoryId");

      const newGame = {
        imageUrl: imageUrl.value,
        title: title.value,
        year: year.value,
        price: price.value,
        categoryId: categoryId.value,
      };
      axios
        .post("http://localhost:5678/game", newGame)
        .then((reply) => {
          if (reply.status == 200) {
            alert("Jogo cadastrado!");
          }
        })
        .catch((err) => {
          console.log(err);
        });
    }

    axios
      .get("http://localhost:5678/games")
      .then((games) => {
        const gameList = games.data;
        const list = document.getElementById("gameList");

        gameList.forEach((game) => {
          const li = document.createElement("li");
          li.innerHTML = `<img src="${game.imageUrl}" height="45px">  ${game.title} -  ${game.year} - R$ ${game.price}<br>
                        `;
          list.appendChild(li);
        });
      })
      .catch((err) => {
        console.log(err);
      });
  </script>
  <script>
    axios
      .get("http://localhost:5678/categories")
      .then((categories) => {
        const categoriesList = categories.data;
        const list = document.getElementById("categoryId");

        categoriesList.forEach((categorie) => {
          const option = document.createElement("option");
          option.innerHTML = `${categorie.title}`;
          list.appendChild(option);
        });
      })
      .catch((err) => {
        console.log(err);
      });
  </script>
</html>
